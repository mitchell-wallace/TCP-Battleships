// https://stackoverflow.com/questions/60865641/get-local-address-for-recieved-data-with-udpclient-listening-on-any-ip-address

static UdpClient client;
static byte[] byts = new byte[8192];

static void ReceiveUDP(IAsyncResult asyncResult)
{
    EndPoint ipEndpoint = new IPEndPoint(IPAddress.Any, 9876);
    IPPacketInformation packetInformation;
    SocketFlags socketFlags = SocketFlags.None;
    int numberOfBytesReceived = client.Client.EndReceiveMessageFrom(asyncResult, ref socketFlags, 
        ref ipEndpoint, out packetInformation);
    Console.WriteLine
    (
        "Received {0} bytes\r\nfrom {1}\r\nReceiving IP Address: {2}\r\nNetwork Interface #{3}\r\n************************************",
        numberOfBytesReceived,
        ipEndpoint,
        packetInformation.Address,
        packetInformation.Interface
    );

    EndPoint anyEndpoint = new IPEndPoint(IPAddress.Any, 9876);
    try
    {
        client.Client.BeginReceiveMessageFrom(byts, 0, 8192, SocketFlags.None, ref anyEndpoint, ReceiveUDP, null);
    }
    catch (Exception beginReceiveError)
    {
        // Console.WriteLine("{0}", beginReceiveError);
    }
}

static void Main(string[] args)
{
    client = new UdpClient(new IPEndPoint(IPAddress.Any, 9876));
    EndPoint anyEndpoint = new IPEndPoint(IPAddress.Any, 9876);
    client.Client.BeginReceiveMessageFrom(byts, 0, 8192, SocketFlags.None, ref anyEndpoint, ReceiveUDP, null);

    UdpClient server = new UdpClient();
    server.Connect("172.20.10.4", 9876);
    server.Send(new byte[] { 1, 2, 3, 4, 5, 6, 7, 8 }, 8);

    UdpClient server2 = new UdpClient();
    server2.Connect("127.0.0.1", 9876);
    server2.Send(new byte[] { 1, 2, 3, 4, 5, 6, 7, 8, 9 }, 9);

    UdpClient server3 = new UdpClient();
    server3.Connect("OOZGUL-NB02", 9876);
    server3.Send(new byte[] { 1, 2, 3, 4, 5, 6, 7, 8, 9 }, 9);

    client.Close();
    server.Close();
    server2.Close();

    Console.ReadLine();
}